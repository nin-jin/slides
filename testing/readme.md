# Новелла о прагматичном тестировании

Вы можете [открыть в интерфейсе проведения презентаций](https://nin-jin.github.io/slides/testing/)

# О себе

- Программирую с 10 лет
- Пилил большие и маленькие сервисы
- В основном фронт, но не только
- Разработал фреймворк, опередивший время
- Сейчас разрабатываю крутую штуку для 1С

# Путь в тестировании

- Не писал тесты
- Избегал тесты
- Без тестировщиков пришлось разбираться самому
- Понял как правильно тестировать
- Хочу поделиться с вами

# Будни разработчика

- Баги
- Деньги
- Сроки
- Менеджеры

# Борьба с багами

- Пиши без багов! (с) Наивный Тимлид
- Поднять отряд ручных тестировщиц! (c) Типичный Менеджер
- Опишем всё типами! (с) Читатель Хабра
- Кажется нам нужны тесты.. (с) Безысходность

# Виды контрактов

- **На словах** - не формальный контракт, никто не проверит
- **На типах** - сложно выразить необходимое
- **На примерах** - это и есть тесты

# Зачем? Обнаружение дефектов как можно раньше!

> *Жизненный цикл фичи: dev -> review -> qa -> uat -> prod*
> *Чем раньше поставить тесты, чем короче цикл отладки.*

# Зачем? Локализация дефектов!

> *Тест указывает на конкретное проблемное место в коде.*

# Зачем? Ускорение разработки!

> *Тест в любом случае придётся написать.*
> *Но перезапускать его быстрее, чем проверять руками.*

# Зачем? Актуальная документация!

> *Отдельная документация всегда врёт.*
> *Даже если это комментарий рядом с кодом.*

# Нелюбовь к тестам: Долго писать

- Медленный запуск
- Много кода
- Много кейсов
- Сложно писать

# Нелюбовь к тестам: Сложно писать

- Нетестируемая архитектура
- Ограниченный тестовый фреймворк

# Нелюбовь к тестам: Всё время ломаются

- Меняются требования
- Меняется понимание требований
- Фиксируется неважное поведение

# Нелюбовь к тестам: Бесполезны

- Проверяют не важное поведение
- Не проверяют важное поведение
- Тавтологические тесты
- Недостаточный охват

# Бесполезные тесты: Недостаточный охват

- Разработчики не умеют в тестирование
- Вредные практики (TDD, GWT)
- Лень

# Идеальные тесты

- Проверяют всё важное
- Не фиксируют неважное
- Минимальное число
- Охватывают все кейсы
- Исполняются быстро
- Писать просто

# Объект тестирования: система (приложение)

Система - едница развёртывания.

![Система](https://habrastorage.org/webt/2l/pj/7z/2lpj7ziss3wkfogjqpp_7y8oo5u.png)

# Объект тестирования: модуль (юнит)

Модуль - единица кода.

![Модули](https://habrastorage.org/webt/j5/lo/c0/j5loc0fpww-tsxydb_exrpr0ymk.png)

# Объект тестирования: компонент (подсистема)

Компонент - единица функциональности.

![Компоненты](https://habrastorage.org/webt/zt/r-/ch/ztr-ch87u4jfaiwt4ixcmtukzfq.png)

# Тип теста: функциональный

> *Чёрный ящик.*
> *Пример: тыкнули палочкой - он сказал "ой".*

# Тип теста: интеграционный

> *Соединённая группа чёрных ящиков.*
> *Пример: парсер + сериализатор.*

# Тип теста: нагрузочный

> *Маленький чёрный ящик боится в окружении танков.*
> *Пример: 1000 раз тыкнули палочкой и замерили время последнего "ой".*

# Вид процесса тестирования: приёмочный

> *Выбраковка на конвеере.*

# Вид процесса тестирования: регрессионный

> *Тут поправил - там поехало.*

# Вид процесса тестирования: дымовой

> *Просто Дженга.*

# Вид процесса тестирования: полный

> *Детальные замеры болта.*

# Вид процесса тестирования: конфигурационный

> *~~Секс~~ Программирование в разных местах.*

# Классификация тестирования

| Процесс | Тип | Объект | Вариации |
|---------|-----|--------|----------|
| Приёмочная проверка.. | ..функциональности.. | ..модулей.. | ..в текущих условиях. |
| Регрессионная проверка.. | ..интеграции.. | ..компонентов.. | ..на разных платформах. |
| Дымовая проверка.. | ..производительности.. | ..системы.. | ..с разными настройками. |
| Полная проверка.. | | |

# Рожок тестирования

![Пирамида и рожок тестирования](https://habrastorage.org/webt/ts/kf/oj/tskfojzogicipakwphg1ztrunpk.png)

# Тестирование в большинстве компаний

1. Разработчики пишут модульные тесты.
2. Приёмочное/регрессионное ручное тестирование при релизе.
3. Автотестеры с сильной задержкой пишут системные тесты.

# Модульные тесты ломают инкапсуляцию

> *Модуль А зависит от модуля Б.*
> *Зависимость от Б выносится в публичный интерфейс.*
> *Часто это знание навязывается через конструктор.*
> *Инкапсуляция не про сокрытие внутренних полей, а про незнание внутренних особенностей.*

# Модульные тесты - хрупкие

> *Модуль А зависит от модуля Б.*
> *Изменили протокол их взаимодействия, не меняя внешнего поведения А.*
> *Сломались тесты А и Б.*

# Модульные тесты не полны

Чем меньше и проще модули, тем более важно их взаимодействие. 2х тестов.

![Тестирование взаимодействия](https://habrastorage.org/webt/r_/kh/ml/r_khmlkalzxp9cys-e1vg_dws3u.png)

# Системные тесты не масштабируются

> *Тестрование самолёта в сборе, чтобы проверить, что шуруп подходит к гайке.*

# Компонентные тесты: Скорость исполнения

*(TestBed в ангуляре давал 100мс на тест)*

# Компонентные тесты: Локализация проблемы

![Порядок исполнения тестов](https://habrastorage.org/webt/jj/rf/_g/jjrf_goaqaltjofbhkkx-gntwh8.png)

Часто запускаются в поизвольном порядке.

# Пирамида или рожок тестирования?

*Хватит вращать рожок тестирования, его нужно просто выбросить.*

# Фрактальные тесты

> *Компонентных тестов столько же сколько модульных*
> *писать их проще чем модульные*
> *исполняются они быстрее чем системные*
> *а покрытие дают сравнимое с системным*

# Что стоит мокать

![Что мокать](https://habrastorage.org/webt/1l/zd/1x/1lzd1xuoykhsh6rpokwjlupi-ii.png)

# Опыт других людей

- [PiterJS#44: Если нужен тест, пусть он будет интеграционным](https://piterjs.org/#meetup=44/speech=should-test-be-integrational)
- [Is TDD Dead?: My personal practice is that I mock almost nothing.](https://youtu.be/z9quxZsLcfo)

# Резюме

- Разработчики не умеют в тестирование и это надо исправлять
- Фиксировать надо важное поведение
- А невавжное фиксировать не надо
- Тесты нужны самому же разаботчику
- Модульные тесты бессмысленны
- Фрактальные тесты наиболее практичны
